#!/usr/bin/perl -w

use strict                       ;

unshift (@INC, '/home/httpd/cgi-bin/') ;

use CXN::Cgi                     ;
  my $cgi   = new CXN::Cgi       ;

use CXN::DeepDB                  ;
  my $depth = new CXN::DeepDB    ;

use CXN::DepthUtil               ;
  my $util  = new CXN::DepthUtil ;

use CXN::Html                    ;
  my $html  = new CXN::Html      ;

use CXN::Form                    ;
  my $form  = new CXN::Form      ;

use CXN::Escape                  ;

$cgi -> get_vars                 ;
$cgi -> get_env                  ;

print $html -> header ( 'Puny Apps', undef , 'black', '/images/cuniform.gif' ) ;
print "<tmpl_include \"/puny.css\">";
print "<LINK rel=\"stylesheet\" href=\"http://puny.vm.com/puny.css\"> ";

my $uri = $cgi -> {'env'}{'SCRIPT_NAME'}.'/'        ;
my $struct_string = $cgi -> {'vars'}{'hidden_struct'} ;
$struct_string = uri_unescape($struct_string)                    ;

my $VAR1 ;
my $struct =  eval $struct_string ;

my $db = $struct -> {'db'}                 ;

$depth -> db( $db ) ;

my $depth_string = $struct -> {'depth'}       ;
my @depth_array = split (/ +/, $depth_string ) ;
  
my $text = $depth -> depth ( @depth_array ) ;

$text = eval $text ;

if ( ref $text eq 'ARRAY' ) {
   $text = join ( "\n", @$text )
}

print $html -> font(3)                   ;
print $html -> div('left')               ;

print $form -> start_form ('Upd', 'Upd' ) ;
print $form -> multi_line ( 'upd_string', 30, 15, $text, undef ) ;
print $form -> hidden ( 'hidden_struct', $struct_string )     ;
print $form -> button ( "Upd" )                            ;
print $form -> end_form                                    ;

print $html -> unfont                                      ;
print $html -> undiv()                                     ;

print $html -> text                                        ;
print $cgi  -> serialize ($cgi)                             ;
print $html -> untext                                      ;
print $html -> end                                         ;

exit;
