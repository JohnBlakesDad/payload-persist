#!/usr/bin/perl -w

use strict                       ;

unshift (@INC, '/home/httpd/cgi-bin/') ;

use CXN::Cgi                     ;
  my $cgi   = new CXN::Cgi       ;
use CXN::DeepDB                  ;
  my $depth = new CXN::DeepDB    ;
use CXN::DepthUtil               ;
  my $util  = new CXN::DepthUtil ;
use CXN::Html                    ;
  my $html  = new CXN::Html      ;
use CXN::Escape                  ;

$cgi -> get_vars                 ;
$cgi -> get_env                  ;

print $html -> header ( 'Puny Apps', undef , 'black', '/images/cuniform.gif' ) ;
#print $html -> header ( ) ;
print "<tmpl_include \"/puny.css\">";
print "<LINK rel=\"stylesheet\" href=\"http://puny.vm.com/puny.css\"> ";


$depth -> db('PUNY')              ; 

#$depth -> write                  ; 

my $depth_arr = [ 'PUNY'] ;
my $depth_str = "PUNY"         ;
 
my $uri = $cgi -> {'env'}{'SCRIPT_NAME'}.'/'        ;

$cgi->{'vars'}{'depth'} = "PerlOS"
#$cgi->{'vars'}{'depth'} = undef 
                      if ! defined $cgi->{'vars'}{'depth'} ; 
$depth_str = $cgi->{'vars'}{'depth'}  ; 
@$depth_arr = split (/ +/, $depth_str) ;
$util -> {depth_arr} = $depth_arr ;

print $html -> font(5)                   ;
print $html -> div('left')               ;
my $level ;
my $out_str = $uri.'?depth='             ; 
my $pr_str ;
foreach $level (@$depth_arr) {
    $out_str .=$level." "              ;   
    $pr_str = uri_escape ( $out_str )    ;
print "<a href=$pr_str> $level > </a>"  ;
}

print "<BR><BR> $level ";
print $html -> unfont                    ;
print $html -> undiv()                   ;
my $search_str = $$depth_arr[$#$depth_arr] ;
$search_str =~ s/<[^<>]*>//g;
print "
<FORM METHOD=POST ACTION=\"/cgi-bin/Depth/\" ENCTYPE=\"application/x-www-for
m-urlencoded\" >
<INPUT TYPE=\"text\" NAME=\"search_input\" >
<INPUT TYPE=\"hidden\" NAME=\"depth\" VALUE=\"$depth_str\">
<INPUT TYPE=\"submit\" VALUE=\"Search $search_str \">
</FORM>
" ;

#<INPUT TYPE=\"submit\" NAME=\"search\" VALUE=\"SEARCH\">
my $x = $depth -> depth(@$depth_arr)     ;

my $VAR1                                 ;
$x = eval $x                             ;
$util -> search($cgi->{'vars'}{'search_input'})
   if $cgi->{'vars'}{'search_input'};

$util -> {'click_depth'} = 'yes' ;
$util -> {'upd'} = 'yes' ;

print $x = $util -> mk_table ( $x )      ;

print $cgi -> serialize ($cgi)           ;
print $html -> end                       ;

exit;
