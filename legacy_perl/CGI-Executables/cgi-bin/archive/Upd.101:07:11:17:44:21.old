#!/usr/bin/perl -w

use strict                       ;

unshift (@INC, '/home/httpd/cgi-bin/') ;

use CXN::Cgi                     ;
  my $cgi   = new CXN::Cgi       ;

use CXN::DeepDB                  ;
  my $depth = new CXN::DeepDB    ;

use CXN::DepthUtil               ;
  my $util  = new CXN::DepthUtil ;

use CXN::Html                    ;
  my $html  = new CXN::Html      ;

use CXN::Form                    ;
  my $form  = new CXN::Form      ;

use CXN::Escape                  ;

$cgi -> get_vars                 ;
$cgi -> get_env                  ;

print $html -> header ( 'Puny Apps', undef , 'black', '/images/cuniform.gif' ) ;
print "<tmpl_include \"/puny.css\">";
print "<LINK rel=\"stylesheet\" href=\"http://puny.vm.com/puny.css\"> ";

my $uri = $cgi -> {'env'}{'SCRIPT_NAME'}.'/'        ;
#my $depth_string = $cgi->{'vars'}{'depth'}  ; 

my $struct_string= $cgi -> {'vars'}{'hidden_struct'} ;

$struct_string = uri_unescape($struct_string)                    ;

my $VAR1 ;
my $struct =  eval $struct_string ;

my $upd_string = $cgi->{'vars'}{'upd_string'}  ; 

$upd_string = uri_unescape($upd_string)                    ;

my $upd_array                                  ;

@$upd_array = split ( "\n" , $upd_string ) ; 

use CXN::PersistOB ;
my $pob = new CXN::PersistOB ;
#$upd_string = $pob -> serialize ( $upd_array ) ;

my $depth_string = $struct -> {'depth'}  ; 

my @depth_array = split (/ +/, $depth_string)                    ;

if (( $#$upd_array == -1 ) or ( $upd_string =~ /^\s*$/ )) {
   $upd_array = undef 
}

my $db = $struct -> {'db'}                 ;

$depth -> db( $db ) ;

$depth -> write     ;

$depth -> upd ( @depth_array, $upd_array )     ;

my $x = $depth -> depth ( @depth_array )     ;

my $VAR1 ;
my $x = eval $x ;

print $util -> mk_table ( $x ) ;

print $cgi -> serialize ($cgi)           ;

print $html -> end                       ;

exit;
